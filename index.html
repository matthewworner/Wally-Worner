<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wally Worner and the Siege of Senglea</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Chewy&family=Patrick+Hand&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Patrick Hand', cursive, sans-serif;
            background: #2c1810;
            /* Dark wood/leather background */
            background-image:
                radial-gradient(circle at center, rgba(0, 0, 0, 0) 0%, rgba(0, 0, 0, 0.4) 100%),
                repeating-linear-gradient(45deg, #3e2723 0, #3e2723 10px, #2c1810 10px, #2c1810 20px);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            perspective: 2000px;
        }

        .book-container {
            width: 90vw;
            max-width: 1200px;
            height: 90vh;
            background: #f4e4bc;
            /* Parchment */
            background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise' x='0' y='0'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100' height='100' filter='url(%23noise)' opacity='0.08'/%3E%3C/svg%3E");
            border-radius: 5px 20px 20px 5px;
            box-shadow:
                inset 20px 0 50px rgba(0, 0, 0, 0.1),
                /* Spine shadow */
                20px 20px 30px rgba(0, 0, 0, 0.5),
                /* Drop shadow */
                0 0 0 10px #5d4037;
            /* Leather cover border */
            border-left: 60px solid #3e2723;
            /* Spine */
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
        }

        /* Spine detail */
        .book-container::before {
            content: '';
            position: absolute;
            left: -55px;
            top: 0;
            bottom: 0;
            width: 4px;
            background: rgba(255, 255, 255, 0.1);
            box-shadow: 5px 0 0 rgba(0, 0, 0, 0.1);
        }

        /* Page Border Design */
        .book-container::after {
            content: '';
            position: absolute;
            top: 10px;
            right: 10px;
            bottom: 10px;
            left: 10px;
            border: 2px solid rgba(139, 69, 19, 0.2);
            pointer-events: none;
            z-index: 1;
        }

        .page {
            flex: 1;
            display: none;
            flex-direction: column;
            padding: 40px;
            padding-bottom: 100px;
            position: relative;
            animation: pageFlip 0.8s cubic-bezier(0.645, 0.045, 0.355, 1);
            min-height: 0;
            gap: 20px;
            transform-origin: left center;
        }

        /* Cover Page Styling */
        .page.cover-page {
            justify-content: center;
            align-items: center;
            text-align: center;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.4) 0%, rgba(244, 228, 188, 0) 70%);
        }

        .cover-title {
            font-family: 'Chewy', cursive;
            font-size: 50px;
            color: #800000;
            text-shadow: 3px 3px 0px rgba(255, 215, 0, 0.6);
            margin-bottom: 20px;
            margin-top: 60px;
            /* Increased top margin greatly to prevent cutoff */
            padding-top: 20px;
            line-height: 1.1;
            z-index: 10;
        }

        .cover-collage {
            position: relative;
            width: 100%;
            height: 400px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .cover-main-img {
            height: 350px;
            z-index: 5;
            filter: drop-shadow(0 10px 20px rgba(0, 0, 0, 0.3));
            transition: transform 0.3s;
        }

        .cover-main-img:hover {
            transform: scale(1.05);
        }

        .cover-bg-img {
            position: absolute;
            opacity: 0.6;
            z-index: 1;
        }

        .cover-decoration {
            font-family: 'Patrick Hand';
            font-size: 24px;
            color: #5d4037;
            margin-top: 20px;
        }

        .start-btn {
            margin-top: 30px;
            font-size: 32px;
            padding: 15px 40px;
            background: #b71c1c;
            color: #fff;
            box-shadow: 0 6px 0 #7f0000;
            animation: pulse 2s infinite;
        }

        .start-btn:hover {
            background: #d32f2f;
            box-shadow: 0 8px 0 #7f0000;
        }

        .start-btn:active {
            transform: translateY(4px);
            box-shadow: 0 0 0 #7f0000;
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }

            100% {
                transform: scale(1);
            }
        }

        .page.active {
            display: flex;
        }

        @keyframes pageFlip {
            from {
                opacity: 0;
                transform: rotateY(-30deg) scale(0.95);
            }

            to {
                opacity: 1;
                transform: rotateY(0) scale(1);
            }
        }

        .illustration {
            width: 100%;
            height: 300px;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            margin-bottom: 0;
            flex-shrink: 0;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            box-shadow: inset 0 0 20px rgba(139, 69, 19, 0.1), 0 0 0 5px rgba(255, 255, 255, 0.4);
            padding: 10px;
            cursor: pointer;
            /* Interaction hint */
        }

        .illustration img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            filter: drop-shadow(0 5px 15px rgba(0, 0, 0, 0.2));
            transition: transform 0.3s ease;
        }

        /* Interactive hover effects */
        .illustration img:hover {
            transform: scale(1.02);
            filter: drop-shadow(0 8px 20px rgba(0, 0, 0, 0.3));
        }

        .text-content {
            width: 100%;
            height: auto;
            overflow-y: visible;
            min-height: 0;
            padding: 25px;
            background: transparent;
            font-size: 20px;
            line-height: 1.8;
            color: #2c1810;
            /* Darker brown for text */
            position: relative;
        }

        /* Drop Cap */
        /* Drop Cap - Only applied to the FIRST paragraph of the PAGE, but NOT inside special containers like teaser-text */
        .text-content>p:first-of-type::first-letter {
            font-family: 'Chewy', cursive;
            font-size: 3.5em;
            float: left;
            line-height: 0.8;
            margin-right: 10px;
            color: #800000;
            text-shadow: 2px 2px 0px rgba(0, 0, 0, 0.1);
        }

        h1 {
            font-family: 'Chewy', cursive;
            color: #800000;
            margin-bottom: 15px;
            text-align: center;
            font-size: 42px;
            text-shadow: 1px 1px 0px rgba(255, 215, 0, 0.5);
            letter-spacing: 1px;
            margin-top: 0;
            border-bottom: 2px solid rgba(128, 0, 0, 0.2);
            padding-bottom: 10px;
        }

        /* Controls */
        .controls {
            position: fixed;
            bottom: 25px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
            display: flex;
            justify-content: center;
            gap: 15px;
            padding: 12px 25px;
            background: rgba(62, 39, 35, 0.95);
            border-radius: 50px;
            border: 3px solid #d7ccc8;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.4);
            width: auto;
        }

        button {
            padding: 10px 25px;
            font-size: 20px;
            font-family: 'Chewy', cursive;
            background: #f4e4bc;
            color: #3e2723;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 0 #8d6e63;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 0 #8d6e63;
            background: #fff;
        }

        button:active {
            transform: translateY(2px);
            box-shadow: 0 0 0 #8d6e63;
        }

        button.icon-btn {
            padding: 10px 15px;
            font-size: 22px;
        }

        /* Map Modal */
        .map-modal,
        .victory-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.85);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            animation: fadeIn 0.3s;
        }

        /* Victory Modal Specifics */
        .victory-content {
            background: #fff;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            border: 10px solid #FFD700;
            max-width: 500px;
            font-family: 'Chewy';
            color: #3e2723;
            box-shadow: 0 0 50px rgba(255, 215, 0, 0.5);
            position: relative;
        }

        .victory-content h2 {
            font-size: 48px;
            color: #b71c1c;
            margin-bottom: 20px;
        }

        .victory-rabbit {
            width: 150px;
            margin-bottom: 20px;
            animation: bounce 2s infinite;
        }

        .map-content {
            width: 85%;
            max-width: 900px;
            height: 75vh;
            background: #a2d2df;
            border: 15px solid #5d4037;
            border-radius: 10px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 50px rgba(0, 0, 0, 0.5);
            cursor: grab;
        }

        /* The styles for the map image */
        .map-content img.map-base {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        .close-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 100;
            background: #b71c1c;
            color: white;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: 3px solid white;
            font-family: 'Chewy', cursive;
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.3);
        }

        .map-marker {
            position: absolute;
            cursor: pointer;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.8);
            transform: translate(-50%, -50%);
            transition: transform 0.2s;
            z-index: 10;
        }

        .map-marker:hover {
            transform: translate(-50%, -50%) scale(1.2);
        }

        .marker-icon {
            font-size: 40px;
            filter: drop-shadow(0 2px 5px rgba(0, 0, 0, 0.3));
        }

        .marker-label {
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.9);
            padding: 5px 10px;
            border-radius: 5px;
            font-family: 'Chewy';
            color: #3e2723;
            white-space: nowrap;
            border: 1px solid #5d4037;
            pointer-events: none;
            font-size: 16px;
        }

        .pirate-ship-icon {
            position: absolute;
            font-size: 50px;
            animation: sailShip 8s linear infinite alternate;
            cursor: pointer;
            filter: drop-shadow(2px 4px 6px rgba(0, 0, 0, 0.3));
            user-select: none;
            z-index: 5;
        }

        /* Interactive Elements Overlay */
        .interactive-overlay {
            position: absolute;
            cursor: pointer;
            font-size: 40px;
            z-index: 15;
            transition: transform 0.2s;
            filter: drop-shadow(2px 4px 4px rgba(0, 0, 0, 0.2));
        }

        .interactive-overlay:hover {
            transform: scale(1.2);
        }

        .interactive-overlay:active {
            transform: scale(0.9);
        }

        .interactive-overlay.popped {
            animation: pop 0.4s ease-out;
        }

        @keyframes pop {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.4);
            }

            100% {
                transform: scale(1);
            }
        }

        @keyframes sailShip {
            0% {
                transform: translate(0, 0) rotate(5deg);
            }

            100% {
                transform: translate(30px, 10px) rotate(-5deg);
            }
        }

        /* Improved Rabbit Game UI */
        .hidden-rabbit {
            position: absolute;
            width: 60px;
            height: auto;
            opacity: 0.9;
            cursor: pointer;
            transition: all 0.3s;
            z-index: 20;
            /* Higher z-index to be clickable */
            filter: drop-shadow(0 0 0 rgba(255, 255, 255, 0));
        }

        .hidden-rabbit:hover {
            transform: scale(1.1) rotate(0deg) !important;
            /* Reset rotate to stand up */
            filter: drop-shadow(0 0 10px #FFD700);
            /* Glow to make it "clear" it's interactive */
            opacity: 1;
        }

        .hidden-rabbit.found {
            animation: rabbitJumpOut 1s forwards;
            pointer-events: none;
        }

        @keyframes rabbitJumpOut {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.5) translateY(-50px) rotate(360deg);
                opacity: 1;
            }

            100% {
                transform: scale(0) translateY(-100px);
                opacity: 0;
            }
        }

        .rabbit-counter-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #f4e4bc;
            padding: 10px 20px;
            border-radius: 10px;
            border: 3px solid #5d4037;
            font-family: 'Chewy';
            color: #5d4037;
            z-index: 150;
            display: flex;
            align-items: center;
            gap: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            font-size: 24px;
            transform: rotate(2deg);
        }

        .rabbit-counter-panel img {
            width: 40px;
        }

        .game-tip {
            position: fixed;
            top: 90px;
            right: 20px;
            background: white;
            padding: 10px;
            border-radius: 10px;
            font-size: 14px;
            max-width: 200px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            z-index: 140;
            display: none;
            /* Shown by JS initially */
            animation: pulse 2s infinite;
        }

        .page-number {
            position: absolute;
            bottom: 25px;
            right: 35px;
            font-family: 'Chewy';
            font-size: 20px;
            color: #5d4037;
            border: 2px solid #5d4037;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.5);
            box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.1);
        }

        .teaser-text {
            border-top: 2px dashed #8d6e63;
            margin-top: 30px;
            padding-top: 20px;
            text-align: center;
            font-size: 18px;
            color: #5d4037;
            font-style: italic;
        }

        /* Animations */
        .anim-float {
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {

            0%,
            100% {
                transform: translateY(0px);
            }

            50% {
                transform: translateY(-10px);
            }
        }

        .anim-sail {
            animation: sail 4s ease-in-out infinite;
        }

        @keyframes sail {

            0%,
            100% {
                transform: rotate(-2deg);
            }

            50% {
                transform: rotate(2deg);
            }
        }

        .anim-glow {
            animation: glow 3s ease-in-out infinite;
        }

        @keyframes glow {

            0%,
            100% {
                filter: drop-shadow(0 0 5px gold);
            }

            50% {
                filter: drop-shadow(0 0 15px gold);
            }
        }

        @keyframes bounce {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-20px);
            }
        }

        .anim-battle {
            animation: shake 0.5s cubic-bezier(.36, .07, .19, .97) infinite;
        }

        @keyframes shake {

            10%,
            90% {
                transform: translate3d(-1px, 0, 0);
            }

            20%,
            80% {
                transform: translate3d(2px, 0, 0);
            }
        }

        /* Responsive */
        @media screen and (min-width: 1025px) {
            .page {
                flex-direction: row;
                gap: 50px;
                padding: 60px;
            }

            .cover-page {
                flex-direction: column !important;
            }

            .illustration {
                width: 50%;
                height: 100%;
                border: none;
                box-shadow: none;
                background: transparent;
            }

            .text-content {
                width: 50%;
                height: 100%;
                overflow-y: auto;
                padding-right: 20px;
                font-size: 24px;
            }

            .controls {
                bottom: 30px;
            }

            .illustration-group {
                flex-direction: column;
                gap: 20px;
            }

            .page8-knight {
                width: 50%;
                display: block !important;
            }

            .page8-house {
                width: 70%;
            }
        }

        @media screen and (max-width: 768px) {
            .book-container {
                border-left: 15px solid #3e2723;
                width: 100vw;
                height: 100vh;
                border-radius: 0;
            }

            .page {
                padding: 20px 20px 100px 20px;
            }

            h1 {
                font-size: 28px;
            }

            .cover-title {
                font-size: 40px;
            }

            .cover-collage {
                height: 300px;
            }

            .cover-main-img {
                height: 200px;
            }

            .controls {
                width: 95%;
                bottom: 10px;
            }

            .text-content p:first-of-type::first-letter {
                font-size: 2.5em;
            }

            .page8-knight {
                display: none;
            }

            .rabbit-counter-panel {
                padding: 5px 10px;
                font-size: 18px;
                top: 10px;
                right: 10px;
            }

            .rabbit-counter-panel img {
                width: 30px;
            }
        }

        .illustration-group {
            position: relative;
            height: 100%;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: row;
        }
    </style>
</head>

<body>
    <audio id="snd-turn" src="https://assets.mixkit.co/active_storage/sfx/2045/2045-preview.mp3"></audio>
    <audio id="snd-yay" src="https://assets.mixkit.co/active_storage/sfx/1114/1114-preview.mp3"></audio>
    <audio id="snd-ocean" src="https://assets.mixkit.co/active_storage/sfx/1188/1188-preview.mp3" loop></audio>
    <audio id="snd-sword" src="https://assets.mixkit.co/active_storage/sfx/1271/1271-preview.mp3"></audio>
    <audio id="snd-cannon" src="https://assets.mixkit.co/active_storage/sfx/1703/1703-preview.mp3"></audio>
    <audio id="snd-bells" src="https://assets.mixkit.co/active_storage/sfx/573/573-preview.mp3"></audio>
    <audio id="snd-pop" src="https://assets.mixkit.co/active_storage/sfx/2578/2578-preview.mp3"></audio>
    <audio id="snd-siren" src="https://assets.mixkit.co/active_storage/sfx/543/543-preview.mp3"></audio>
    <audio id="snd-plane" src="https://assets.mixkit.co/active_storage/sfx/936/936-preview.mp3"></audio>

    <div class="rabbit-counter-panel">
        <img src="assets/images/rabbit.png" alt="Rabbit"> <span id="rabbit-count">0/8 Found</span>
    </div>

    <div style="position: fixed; top: 20px; left: 20px; z-index: 150;">
        <select id="bookSelect" onchange="changeBook(this.value)"
            style="padding: 10px; font-family: 'Chewy'; font-size: 20px; border-radius: 10px; background: #FFD700; border: 3px solid #5d4037; color: #5d4037; cursor: pointer; box-shadow: 0 4px 5px rgba(0,0,0,0.3);">
            <option value="book1">Book 1: Siege of Malta (1565)</option>
            <option value="book2">Book 2: Fortress Malta (1940)</option>
        </select>
    </div>

    <div class="game-tip" id="gameTip">
        <strong>Psst!</strong> Help Wally find the hidden rabbits on each page! üê∞
    </div>

    <div class="book-container">
        <!-- BOOK 1 PAGES (Original) -->
        <div class="page cover-page active book1-page">
            <h1 class="cover-title">Wally Worner<br>and the<br>Siege of Malta</h1>

            <div class="cover-collage">
                <img src="assets/images/castle.png" class="cover-bg-img"
                    style="left: 10%; top: 20%; transform: rotate(-10deg); width: 150px;">
                <img src="assets/images/ship.png" class="cover-bg-img"
                    style="right: 10%; top: 30%; transform: rotate(10deg); width: 150px;">
                <img src="assets/images/rabbit.png" class="cover-bg-img"
                    style="bottom: 10%; right: 20%; width: 80px; opacity: 1;">

                <img src="assets/images/worner.png?v=2" alt="Wally Worner" class="cover-main-img">
            </div>

            <p class="cover-decoration">A Tale of Courage, Honor, and Rabbits</p>

            <button class="start-btn" onclick="nextPage()">Start Reading</button>
        </div>

        <div class="page book1-page">
            <img src="assets/images/rabbit.png" class="hidden-rabbit"
                style="bottom: 85px; left: 30px; transform: rotate(10deg);" onclick="foundRabbit(this)">
            <div class="illustration" onclick="animateElement(this, 'wiggle')">
                <img src="assets/images/worner.png?v=2" alt="Wally Worner" class="anim-float click-wiggle">
            </div>
            <div class="text-content">
                <h1>Wally Worner and the Siege of Malta</h1>
                <p><strong>A Tale of Courage and Honor</strong></p>
                <p style="margin-top: 20px;">Long ago in 1565, there lived a brave knight named Wally Worner. His name
                    meant "guardian warrior," and he carried a bright yellow shield with a bold red stripe and six red
                    flowers.</p>
                <p style="margin-top: 15px;">His family motto was: <em>"Non nobis tantum nati"</em> ‚Äî "Not born for
                    ourselves alone."</p>
                <p style="margin-top: 15px;">This is the story of how Wally helped save Malta and defended a
                    special house that would shine like a star through the centuries...</p>
            </div>
            <div class="page-number">1</div>
        </div>

        <div class="page book1-page">
            <img src="assets/images/rabbit.png" class="hidden-rabbit"
                style="top: 20px; right: 30px; transform: rotate(-5deg);" onclick="foundRabbit(this)">
            <div class="interactive-overlay" style="bottom: 50px; left: 40px;" onclick="interactFood(this)"
                title="Maltese Bread">üçû</div>
            <div class="interactive-overlay" style="bottom: 40px; right: 80px; font-size: 35px;"
                onclick="interactFood(this)" title="Cheese">üßÄ</div>

            <div class="illustration" onclick="animateElement(this, 'wiggle')">
                <img src="assets/images/castle.png" alt="Castle" class="anim-float click-wiggle">
            </div>
            <div class="text-content">
                <h1>The Call to Malta</h1>
                <p>One spring morning, a messenger arrived at Wally Worner's castle with urgent news. The beautiful
                    island of Malta was in danger! The Ottoman Empire was sailing there with a huge fleet of ships.</p>
                <p style="margin-top: 15px;"><em>"Malta needs brave knights!"</em> the messenger cried.</p>
                <p style="margin-top: 15px;">Wally looked at his shield. He looked at his motto. He knew what he had to
                    do. He packed his favorite cheese, his rusty sword, and said goodbye to his castle.</p>
                <p style="margin-top: 15px;"><em>"I am coming, Malta!"</em> he shouted.</p>
            </div>
            <div class="page-number">2</div>
        </div>

        <div class="page book1-page">
            <img src="assets/images/rabbit.png" class="hidden-rabbit"
                style="top: 130px; left: 40px; transform: rotate(5deg); opacity: 0.8;" onclick="foundRabbit(this)">
            <div class="illustration" onclick="animateElement(this, 'sail')">
                <img src="assets/images/ship.png" alt="Ship" class="anim-sail click-wiggle">
            </div>
            <div class="text-content">
                <h1>The Journey Across the Sea</h1>
                <p>The voyage across the Mediterranean Sea was Wally Worner's first great adventure. His ship battled
                    stormy waves that splashed salty water everywhere!</p>
                <p style="margin-top: 15px;"><em>"Whoosh! Crash!"</em> went the waves.</p>
                <p style="margin-top: 15px;">They even saw pirates in the distance! But Wally stood tall at the front of
                    the ship, looking for land. Finally, he saw golden walls shining in the sun. It was the Grand
                    Harbour of Malta.</p>
                <p style="margin-top: 15px;">The water was the bluest blue he had ever seen.</p>
            </div>
            <div class="page-number">3</div>
        </div>

        <div class="page book1-page">
            <img src="assets/images/rabbit.png" class="hidden-rabbit" style="bottom: 120px; right: 30px;"
                onclick="foundRabbit(this)">
            <div class="interactive-overlay" style="bottom: 60px; right: 100px; font-size: 30px;"
                onclick="interactFood(this)" title="Sausage">üå≠</div>
            <div class="illustration" onclick="animateElement(this, 'wiggle')">
                <img src="assets/images/fortress.png" alt="Fortress" class="click-wiggle">
            </div>
            <div class="text-content">
                <h1>Meeting Jean de la Valette</h1>
                <p>Wally landed in Birgu and met the Grand Master, Jean de la Valette. He was very serious and looked
                    very strong.</p>
                <p style="margin-top: 15px;">Jean de la Valette turned to Wally: <em>"Take command of the harbor
                        post at Senglea. We must protect it at all costs!"</em></p>
                <p style="margin-top: 15px;">Wally saluted. <em>"I will not let you down, sir!"</em></p>
                <p style="margin-top: 15px;">He marched to Senglea, a peninsula surrounded by water. It felt like
                    standing
                    on the deck of a giant stone ship.</p>
            </div>
            <div class="page-number">4</div>
        </div>

        <div class="page book1-page">
            <img src="assets/images/rabbit.png" class="hidden-rabbit"
                style="top: 20px; left: 20px; transform: rotate(15deg);" onclick="foundRabbit(this)">
            <div class="interactive-overlay" style="top: 80px; left: 40px;" onclick="interactFood(this)"
                title="Honey Ring">ü•Ø</div>
            <div class="illustration" onclick="animateElement(this, 'glow')">
                <img src="assets/images/house_stella.png" alt="Stella House" class="anim-glow click-glow">
            </div>
            <div class="interactive-overlay"
                onclick="showRealPhoto('assets/images/real_stella/window_view.jpg', 'Looking out from Stella in Senglea!')"
                style="position:absolute; bottom:20px; right:40px; font-size:30px; background:white; padding:5px; border-radius:50%; border:2px solid #5d4037;">
                üì∏</div>
            <div class="text-content">
                <h1>The House Called Stella</h1>
                <p>That night, Wally Worner explored the streets of Senglea. He walked down Triq il-Kurcifiss‚Äîthe Street
                    of the Crucifix. The houses were tall and made of golden stone.</p>
                <p style="margin-top: 15px;">One house stood out. It was number 38. It felt special. It felt...
                    warm.</p>
                <p style="margin-top: 15px;"><em>"This house is like a star,"</em> Wally thought. <em>"I will call it
                        Stella."</em></p>
                <p style="margin-top: 15px;">He promised then and there to protect this house and all the families
                    living in Senglea. He knew the big battle was coming soon.</p>
            </div>
            <div class="page-number">5</div>
        </div>

        <div class="page book1-page">
            <img src="assets/images/rabbit.png" class="hidden-rabbit"
                style="bottom: 20px; left: 50%; transform: translateX(-50%);" onclick="foundRabbit(this)">
            <!-- Interactive Cannons -->
            <div class="interactive-overlay" style="bottom: 60px; left: 40px; font-size: 50px;"
                onclick="fireCannon(this)" title="Fire Cannon!">üí•</div>

            <div class="illustration" onclick="animateElement(this, 'shake')">
                <img src="assets/images/battle.png" alt="Battle" class="anim-battle click-wiggle">
            </div>
            <div class="text-content">
                <h1>The Great Battle for Senglea</h1>
                <p>Boom! Bang! The Ottoman ships attacked! The Great Siege had begun.</p>
                <p style="margin-top: 15px;">Cannonballs flew through the air. Pirates tried to climb the walls! But
                    Wally Worner was ready. He stood on the walls of Senglea, waving his yellow and red shield.</p>
                <p style="margin-top: 15px;"><em>"For Malta! For Stella!"</em> he cheered.</p>
                <p style="margin-top: 15px;">He helped the soldiers. He carried water to the thirsty. He was everywhere
                    at once! The enemy saw his brave shield and got scared. <em>"Run away!"</em> they shouted.</p>
            </div>
            <div class="page-number">6</div>
        </div>

        <div class="page book1-page">
            <img src="assets/images/rabbit.png" class="hidden-rabbit" style="top: 30px; left: 50px;"
                onclick="foundRabbit(this)">
            <div class="interactive-overlay" style="top: 120px; left: 60px; font-size: 45px;"
                onclick="interactFood(this)" title="Rabbit Stew">ü•ò</div>
            <div class="illustration" onclick="animateElement(this, 'glow')">
                <img src="assets/images/real_stella/kitchen.jpg" alt="Stella Kitchen" class="anim-glow click-glow"
                    style="border: 5px solid #FFD700; border-radius: 10px; width: 80%;">
            </div>
            <div class="text-content">
                <h1>Stella - The Star</h1>
                <p>After months of fighting, the Great Siege was over! The Ottomans sailed away. Malta had won!</p>
                <p style="margin-top: 15px;">Jean de la Valette raised his cup: <em>"To Wally Worner, the Guardian of
                        Senglea!"</em></p>
                <p style="margin-top: 15px;">As a reward for his bravery, the Grand Master gave Wally the keys to house
                    number 38.</p>
                <p style="margin-top: 15px;">Wally held a big feast in the kitchen. They ate delicious rabbit stew
                    (<em>stuffat tal-fenek</em>) and celebrated. The house of Stella was safe, thanks to
                    Sir Wallace Worner's courage.</p>
                <p style="font-size: 16px; color: #555; text-align: center; margin-top: 10px;">(This is the REAL kitchen
                    of Stella in the picture!)</p>
            </div>
            <div class="page-number">7</div>
        </div>

        <div class="page book1-page">
            <img src="assets/images/rabbit.png" class="hidden-rabbit" style="bottom: 20px; right: 20px;"
                onclick="foundRabbit(this)">
            <div class="illustration">
                <div class="illustration-group">
                    <img src="assets/images/worner.png?v=2" alt="Wally Worner"
                        class="anim-float page8-knight click-wiggle" onclick="animateElement(this, 'wiggle')">
                    <img src="assets/images/house_stella.png" alt="Stella House" class="page8-house click-glow"
                        onclick="animateElement(this, 'glow')">
                </div>
            </div>
            <div class="text-content">
                <h1>The Legacy Lives On</h1>
                <p>The siege continued, but Malta was saved!</p>
                <p style="margin-top: 15px;">Wally Worner made Stella his home. He restored its battle-damaged walls,
                    planted flowers, and built a rabbit hutch in the courtyard.</p>
                <p style="margin-top: 15px;">Years passed, then decades, then centuries. Stella remained, passed down
                    through generations. Each generation added their stories, but never forgot the brave knight who
                    defended it.</p>
                <p style="margin-top: 15px;">And the story doesn't end here... nearly 400 years later, another Wally
                    Worner would live in this very same house...</p>

                <div class="teaser-text">
                    <p><strong>NOW AVAILABLE!</strong></p>
                    <p>Switch books to read:<br>"Wally Worner's Grandson and the Siege of Malta 1940-1943"</p>
                </div>
            </div>
            <div class="page-number">8</div>
        </div>


        <!-- BOOK 2 PAGES (WWII) -->
        <div class="page cover-page book2-page">
            <h1 class="cover-title" style="color: #1a237e; text-shadow: 3px 3px 0px rgba(255, 255, 255, 0.6);">Wally
                Worner<br>and<br>Fortress Malta</h1>

            <div class="cover-collage">
                <img src="assets/images/ship.png" class="cover-bg-img"
                    style="left: 10%; top: 20%; transform: rotate(-10deg); width: 150px; filter: grayscale(100%) sepa(0.5);">
                <img src="assets/images/real_stella/rooftop.jpg" class="cover-bg-img"
                    style="right: 15%; top: 30%; transform: rotate(10deg); width: 200px; border: 5px solid white; box-shadow: 0 5px 10px rgba(0,0,0,0.3);">

                <!-- Placeholder for WWII Wally, re-using Knight for now but conceptually different -->
                <img src="assets/images/worner.png?v=2" alt="Wally Worner Jr." class="cover-main-img"
                    style="filter: sepia(0.3);">
            </div>

            <p class="cover-decoration" style="color: #1a237e;">A Story of 1940, Spitfires, and the George Cross</p>

            <button class="start-btn" style="background: #1a237e; box-shadow: 0 6px 0 #0d47a1;"
                onclick="nextPage()">Start Adventure</button>
        </div>

        <div class="page book2-page">
            <img src="assets/images/rabbit.png" class="hidden-rabbit"
                style="bottom: 85px; left: 30px; transform: rotate(10deg);" onclick="foundRabbit(this)">
            <div class="illustration">
                <img src="assets/images/real_stella/staircase.jpg" alt="Attic Stairs" class="anim-glow"
                    style="border: 5px solid #fff; width: 80%;">
            </div>
            <div class="text-content">
                <h1>Discovery in the Attic</h1>
                <p>It was the year 1940. In the house called Stella at 38 Triq il-Kurcifiss, a young boy named Wally
                    Worner Jr. was exploring the attic.</p>
                <p style="margin-top: 15px;">It was dusty and full of old trunks. In the corner, hidden under a blanket,
                    he found something amazing. A shield! It was yellow with a red stripe and six red roses.</p>
                <p style="margin-top: 15px;"><em>"Non nobis tantum nati"</em> he read on the scroll. "Not born for
                    ourselves alone."</p>
                <p style="margin-top: 15px;">"That was your ancestor's," his Nanna said. "Sir Wally Worner. He defended
                    this house 400 years ago. Now, it looks like trouble is coming to Malta again..."</p>
            </div>
            <div class="page-number">1</div>
        </div>

        <div class="page book2-page">
            <img src="assets/images/rabbit.png" class="hidden-rabbit" style="top: 20px; right: 30px;"
                onclick="foundRabbit(this)">
            <div class="illustration" onclick="animateElement(this, 'shake')">
                <img src="assets/images/battle.png" alt="Air Raid" class="anim-float" style="filter: grayscale(0.5);">
            </div>
            <div class="text-content">
                <h1>The Sky Turns Dark</h1>
                <p>June 1940. The sirens wailed! <em>"Wooooooo!"</em></p>
                <p style="margin-top: 15px;">Wally ran to the roof. He saw planes in the sky, but they weren't friendly.
                    They were Italian bombers!</p>
                <p style="margin-top: 15px;">But then, three tiny biplanes rose up to fight them. They were named
                    <strong>Faith, Hope, and Charity</strong>.
                </p>
                <p style="margin-top: 15px;">"Look at them go!" Wally cheered. "Only three planes against the whole
                    enemy air force!" Just like Sir Wally long ago, the odds were impossible, but Malta stood firm.</p>
            </div>
            <div class="page-number">2</div>
        </div>

        <div class="page book2-page">
            <img src="assets/images/rabbit.png" class="hidden-rabbit" style="bottom: 120px; left: 40px;"
                onclick="foundRabbit(this)">
            <div class="illustration">
                <!-- Using the real Kitchen photo for the Shelter/Food context -->
                <img src="assets/images/real_stella/kitchen.jpg" alt="Kitchen Shelter" class="click-wiggle"
                    style="border: 5px solid #fff; opacity: 0.9;">
            </div>
            <div class="text-content">
                <h1>Life Underground</h1>
                <p>Bombs began to fall every day. The Worner family had to move into the shelter‚Äîcaves dug deep into the
                    yellow limestone under Senglea.</p>
                <p style="margin-top: 15px;">It was dark and crowded, but everyone helped each other. They shared what
                    little food they had.</p>
                <p style="margin-top: 15px;">"We have no meat," Nanna sighed. "But we have garlic, we have peas... I
                    will make a special stew."</p>
                <p style="margin-top: 15px;">Wally smiled. Even in the dark, the smell of Nanna's cooking made it feel
                    like home. "We are safe here," he told his little sister. "The rock of Malta protects us."</p>
            </div>
            <div class="page-number">3</div>
        </div>

        <div class="page book2-page">
            <img src="assets/images/rabbit.png" class="hidden-rabbit" style="top: 30px; left: 20px;"
                onclick="foundRabbit(this)">
            <div class="interactive-overlay" style="bottom: 60px; right: 40px; font-size: 60px;"
                onclick="playSound('plane')" title="Spitfire Flyby!">‚úàÔ∏è</div>
            <div class="illustration" onclick="animateElement(this, 'sail')">
                <img src="assets/images/ship.png" alt="Spitfire Delivery" class="anim-sail" style="filter: sepia(0.5);">
            </div>
            <div class="text-content">
                <h1>The Spitfires Arrive!</h1>
                <p>April 1942. Things looked bad. But then, a roar filled the sky!</p>
                <p style="margin-top: 15px;"><em>"VROOOOM!"</em></p>
                <p style="margin-top: 15px;">"Look!" Wally shouted from the roof. "Spitfires!"</p>
                <p style="margin-top: 15px;">Beautiful, sleek fighter planes were landing at Ta' Qali. They had flown
                    off a giant aircraft carrier called the USS Wasp. Now Malta had a sting! The German Stuka bombers
                    were in for a surprise.</p>
            </div>
            <div class="page-number">4</div>
        </div>

        <div class="page book2-page">
            <img src="assets/images/rabbit.png" class="hidden-rabbit" style="bottom: 50px; right: 50px;"
                onclick="foundRabbit(this)">
            <div class="illustration" onclick="animateElement(this, 'shake')">
                <img src="assets/images/real_stella/window_view.jpg" alt="Window View" class="anim-battle"
                    style="border: 5px solid white;">
            </div>
            <div class="text-content">
                <h1>Stella Under Fire</h1>
                <p>One terrible afternoon, a bomb whistled down. <em>"Eeeeeeeee-BOOM!"</em></p>
                <p style="margin-top: 15px;">It landed right on Triq il-Kurcifiss! Dust and smoke filled the air. Wally
                    coughed and covered his eyes.</p>
                <p style="margin-top: 15px;">When the dust settled, he looked up. House number 38... was it gone?</p>
                <p style="margin-top: 15px;">No! The walls were scarred, and the windows were broken, but <strong>Stella
                        still stood</strong>. It was tough, just like the people of Senglea.</p>
            </div>
            <div class="page-number">5</div>
        </div>

        <div class="page book2-page">
            <img src="assets/images/rabbit.png" class="hidden-rabbit" style="top: 50px; right: 20px;"
                onclick="foundRabbit(this)">
            <div class="interactive-overlay" style="top: 100px; left: 40px; font-size: 50px;" onclick="playSound('yay')"
                title="Cheer!">üéñÔ∏è</div>
            <div class="illustration">
                <!-- Placeholder for George Cross/Ceremony -->
                <img src="assets/images/fortress.png" alt="George Cross" class="anim-glow"
                    style="filter: hue-rotate(180deg);">
            </div>
            <div class="text-content">
                <h1>The George Cross</h1>
                <p>King George VI in England heard about how brave the people of Malta were. He decided to do something
                    no King had ever done before.</p>
                <p style="margin-top: 15px;">He awarded the George Cross medal to <strong>the whole island</strong>!</p>
                <p style="margin-top: 15px;">"To honour her brave people, I award the George Cross to the Island
                    Fortress of Malta to bear witness to a heroism and devotion that will long be famous in history."
                </p>
                <p style="margin-top: 15px;">Wally pinned a paper cross to his shirt. He was proud to be Maltese.</p>
            </div>
            <div class="page-number">6</div>
        </div>

        <div class="page book2-page">
            <img src="assets/images/rabbit.png" class="hidden-rabbit" style="bottom: 20px; left: 20px;"
                onclick="foundRabbit(this)">
            <div class="illustration">
                <div class="illustration-group">
                    <img src="assets/images/worner.png?v=2" alt="Wally Worner Jr" class="page8-knight click-wiggle"
                        style="filter: sepia(0.4);">
                    <img src="assets/images/real_stella/bedroom.jpg" alt="Stella Bedroom" class="page8-house click-glow"
                        style="border: 5px solid white; width: 60%; height: auto;">
                </div>
            </div>
            <div class="text-content">
                <h1>Victory and Peace</h1>
                <p>Finally, in November 1942, the siege was broken. Food ships arrived! The enemy planes stopped coming.
                </p>
                <p style="margin-top: 15px;">Wally stood in his bedroom at Stella. He looked at the old shield, and then
                    out the window at the peaceful harbour.</p>
                <p style="margin-top: 15px;">"Two sieges," he whispered. "Two Wallys. But one house."</p>
                <p style="margin-top: 15px;">Stella had survived again. And the legend of the Worner family‚Äîthe
                    guardians of Senglea‚Äîwould live on forever.</p>
                <p style="font-size: 16px; color: #555; text-align: center; margin-top: 10px;">(You can see the real
                    bedroom of Stella in the photo!)</p>
            </div>
            <div class="page-number">7</div>
        </div>


        <div class="controls">
            <button id="prevBtn" onclick="previousPage()">‚Üê Previous</button>
            <button id="mapBtn" class="icon-btn" onclick="toggleMap()">üó∫Ô∏è</button>
            <button id="sndBtn" class="icon-btn" onclick="toggleSound()">üîä</button>
            <button id="nextBtn" onclick="nextPage()">Next ‚Üí</button>
        </div>
    </div>

    <!-- Map Modal -->
    <div class="map-modal" id="mapModal">
        <div class="map-content" id="mapContent">
            <div class="close-btn" onclick="toggleMap()">√ó</div>
            <img src="assets/images/map_malta.png" class="map-base" alt="Map of Malta">

            <!-- Markers -->
            <div class="map-marker" style="top: 55%; left: 52%;" onclick="zoomMap('senglea')">
                <div class="marker-icon">‚≠ê</div>
                <div class="marker-label">Stella House (Senglea)</div>
            </div>

            <div class="map-marker" style="top: 45%; left: 60%;" onclick="zoomMap('birgu')">
                <div class="marker-icon">üè∞</div>
                <div class="marker-label">Fort St. Angelo</div>
            </div>

            <div class="map-marker" style="top: 30%; left: 30%;" onclick="zoomMap('valletta')">
                <div class="marker-icon">üèôÔ∏è</div>
                <div class="marker-label">Valletta</div>
            </div>

            <!-- Enemies -->
            <div class="pirate-ship-icon" style="bottom: 20%; left: 10%;" title="Enemy Fleet">‚öì</div>
            <div class="pirate-ship-icon" style="bottom: 30%; left: 80%; animation-delay: 2s;" title="Enemy Fleet">‚öì
            </div>
        </div>
    </div>

    <div class="map-modal" id="photoModal" onclick="closePhoto()">
        <div class="victory-content" style="max-width: 80vh; width: auto; background: #fff; padding: 20px;">
            <div class="close-btn" style="top: -20px; right: -20px;" onclick="closePhoto()">√ó</div>
            <h2 id="photoCaption" style="font-size: 30px; margin-bottom: 10px;">Real Life Stella</h2>
            <img id="realPhotoImg" src=""
                style="max-width: 100%; max-height: 60vh; border-radius: 10px; border: 5px solid #5d4037;">
        </div>
    </div>

    <!-- Victory Modal -->
    <div class="victory-modal" id="victoryModal">
        <div class="victory-content" id="victoryContent">
            <div class="close-btn" style="top: -20px; right: -20px;" onclick="closeVictory()">√ó</div>
            <h2>Rabbit Hero!</h2>
            <img src="assets/images/rabbit.png" class="victory-rabbit" alt="Happy Rabbit">
            <p style="font-size: 24px;">You found all 8 hidden rabbits!</p>
            <p>The Knights of Malta salute your keen eyes!</p>
        </div>
    </div>

    <script>
        let currentBook = 'book1';
        let currentPage = 0;
        let totalPages = 0;
        let soundEnabled = true;
        let rabbitCount = 0;
        const totalRabbits = 8;

        // Sound Elements
        const sounds = {
            turn: document.getElementById('snd-turn'),
            yay: document.getElementById('snd-yay'),
            ocean: document.getElementById('snd-ocean'),
            sword: document.getElementById('snd-sword'),
            cannon: document.getElementById('snd-cannon'),
            bells: document.getElementById('snd-bells'),
            pop: document.getElementById('snd-pop'),
            siren: document.getElementById('snd-siren'),
            plane: document.getElementById('snd-plane')
        };

        function init() {
            // Initial setup using URL param if exists, else book1
            changeBook('book1');
        }

        function changeBook(bookName) {
            currentBook = bookName;
            currentPage = 0;

            // Re-query only relevant pages to determine count
            const bookPages = document.querySelectorAll('.' + currentBook + '-page');
            totalPages = bookPages.length;

            updateDisplay();
        }

        function updateDisplay() {
            const allPages = document.querySelectorAll('.page');
            allPages.forEach(p => p.style.display = 'none');
            allPages.forEach(p => p.classList.remove('active'));

            const bookPages = document.querySelectorAll('.' + currentBook + '-page');

            if (bookPages[currentPage]) {
                bookPages[currentPage].style.display = 'flex';
                // Trigger reflow for animation
                setTimeout(() => bookPages[currentPage].classList.add('active'), 10);
            }

            document.getElementById('prevBtn').disabled = currentPage === 0;
            document.getElementById('nextBtn').innerText = currentPage === totalPages - 1 ? 'Finish' : 'Next ‚Üí';
        }

        function nextPage() {
            if (currentPage < totalPages - 1) {
                currentPage++;
                playSound('turn');
                updateDisplay();
            }
        }

        function previousPage() {
            if (currentPage > 0) {
                currentPage--;
                playSound('turn');
                updateDisplay();
            }
        }

        function toggleSound() {
            soundEnabled = !soundEnabled;
            document.getElementById('sndBtn').innerText = soundEnabled ? 'üîä' : 'üîá';
            if (soundEnabled) {
                if (currentPage === 0) tryPlayOcean();
            } else {
                sounds.ocean.pause();
            }
        }

        function playSound(name) {
            if (!soundEnabled) return;
            if (sounds[name]) {
                sounds[name].currentTime = 0;
                sounds[name].play().catch(e => console.log("Audio play failed / user interaction needed"));
            }
        }

        function tryPlayOcean() {
            sounds.ocean.volume = 0.3;
            sounds.ocean.play().catch(e => { });
        }

        // Rabbit Game
        function foundRabbit(element) {
            if (element.classList.contains('found')) return;

            element.classList.add('found');
            rabbitCount++;
            document.getElementById('rabbit-count').innerText = rabbitCount + "/" + totalRabbits + " Found";
            playSound('pop');

            if (rabbitCount === totalRabbits) {
                setTimeout(() => {
                    document.getElementById('victoryModal').style.display = 'flex';
                    playSound('yay');
                    playSound('bells');
                }, 500);
            }
        }

        function closeVictory() {
            document.getElementById('victoryModal').style.display = 'none';
        }

        // Map
        function toggleMap() {
            const modal = document.getElementById('mapModal');
            modal.style.display = modal.style.display === 'flex' ? 'none' : 'flex';
        }

        function zoomMap(location) {
            alert("This place was vital during the " + (currentBook === 'book1' ? "Great Siege of 1565!" : "Second Siege of 1940!"));
        }

        function showRealPhoto(src, caption) {
            const modal = document.getElementById('photoModal');
            document.getElementById('realPhotoImg').src = src;
            document.getElementById('photoCaption').innerText = caption;
            modal.style.display = 'flex';
        }

        function closePhoto() {
            document.getElementById('photoModal').style.display = 'none';
        }

        // Interaction
        function animateElement(element, animationClass) {
            element.classList.remove(animationClass);
            void element.offsetWidth; // trigger reflow
            element.classList.add(animationClass);
        }

        function interactFood(element) {
            animateElement(element, 'popped');
            playSound('pop');
            setTimeout(() => {
                element.style.opacity = '0';
                element.style.pointerEvents = 'none';
            }, 200);
        }

        function fireCannon(element) {
            animateElement(element, 'popped');
            playSound('cannon');
            // Shake the screen
            document.body.style.animation = "shake 0.5s";
            setTimeout(() => document.body.style.animation = "", 500);
        }

        // Keyboard support
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowRight') nextPage();
            if (e.key === 'ArrowLeft') previousPage();
        });

        // Start
        init();

        // Show game tip
        setTimeout(() => {
            document.getElementById('gameTip').style.display = 'block';
            setTimeout(() => {
                document.getElementById('gameTip').style.display = 'none';
            }, 5000);
        }, 1000);
    </script>
</body>

</html>