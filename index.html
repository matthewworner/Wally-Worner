<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wally Worner and the Siege of Senglea</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Chewy&family=Patrick+Hand&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Patrick Hand', cursive, sans-serif;
            background: #2c1810;
            /* Dark wood/leather background */
            background-image:
                radial-gradient(circle at center, rgba(0, 0, 0, 0) 0%, rgba(0, 0, 0, 0.4) 100%),
                repeating-linear-gradient(45deg, #3e2723 0, #3e2723 10px, #2c1810 10px, #2c1810 20px);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
            perspective: 2000px;
        }

        .book-container {
            width: 90vw;
            max-width: 1200px;
            height: 90vh;
            background: #f4e4bc;
            /* Parchment */
            background-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise' x='0' y='0'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100' height='100' filter='url(%23noise)' opacity='0.08'/%3E%3C/svg%3E");
            border-radius: 5px 20px 20px 5px;
            box-shadow:
                inset 20px 0 50px rgba(0, 0, 0, 0.1),
                /* Spine shadow */
                20px 20px 30px rgba(0, 0, 0, 0.5),
                /* Drop shadow */
                0 0 0 10px #5d4037;
            /* Leather cover border */
            border-left: 60px solid #3e2723;
            /* Spine */
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
        }

        /* Spine detail */
        .book-container::before {
            content: '';
            position: absolute;
            left: -55px;
            top: 0;
            bottom: 0;
            width: 4px;
            background: rgba(255, 255, 255, 0.1);
            box-shadow: 5px 0 0 rgba(0, 0, 0, 0.1);
        }

        /* Page Border Design */
        .book-container::after {
            content: '';
            position: absolute;
            top: 10px;
            right: 10px;
            bottom: 10px;
            left: 10px;
            border: 2px solid rgba(139, 69, 19, 0.2);
            pointer-events: none;
            z-index: 1;
        }

        .page {
            flex: 1;
            display: none;
            flex-direction: column;
            padding: 40px;
            padding-bottom: 100px;
            position: relative;
            animation: pageFlip 0.8s cubic-bezier(0.645, 0.045, 0.355, 1);
            min-height: 0;
            gap: 20px;
            transform-origin: left center;
        }

        /* Cover Page Styling */
        .page.cover-page {
            justify-content: center;
            align-items: center;
            text-align: center;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.4) 0%, rgba(244, 228, 188, 0) 70%);
        }

        .cover-title {
            font-family: 'Chewy', cursive;
            font-size: 60px;
            color: #800000;
            text-shadow: 3px 3px 0px rgba(255, 215, 0, 0.6);
            margin-bottom: 30px;
            line-height: 1.1;
            z-index: 10;
        }

        .cover-collage {
            position: relative;
            width: 100%;
            height: 400px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .cover-main-img {
            height: 350px;
            z-index: 5;
            filter: drop-shadow(0 10px 20px rgba(0, 0, 0, 0.3));
            transition: transform 0.3s;
        }

        .cover-main-img:hover {
            transform: scale(1.05);
        }

        .cover-bg-img {
            position: absolute;
            opacity: 0.6;
            z-index: 1;
        }

        .cover-decoration {
            font-family: 'Patrick Hand';
            font-size: 24px;
            color: #5d4037;
            margin-top: 20px;
        }

        .start-btn {
            margin-top: 30px;
            font-size: 32px;
            padding: 15px 40px;
            background: #b71c1c;
            color: #fff;
            box-shadow: 0 6px 0 #7f0000;
            animation: pulse 2s infinite;
        }

        .start-btn:hover {
            background: #d32f2f;
            box-shadow: 0 8px 0 #7f0000;
        }

        .start-btn:active {
            transform: translateY(4px);
            box-shadow: 0 0 0 #7f0000;
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.05);
            }

            100% {
                transform: scale(1);
            }
        }

        .page.active {
            display: flex;
        }

        @keyframes pageFlip {
            from {
                opacity: 0;
                transform: rotateY(-30deg) scale(0.95);
            }

            to {
                opacity: 1;
                transform: rotateY(0) scale(1);
            }
        }

        .illustration {
            width: 100%;
            height: 300px;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            margin-bottom: 0;
            flex-shrink: 0;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            box-shadow: inset 0 0 20px rgba(139, 69, 19, 0.1), 0 0 0 5px rgba(255, 255, 255, 0.4);
            padding: 10px;
            cursor: pointer;
            /* Interaction hint */
        }

        .illustration img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
            filter: drop-shadow(0 5px 15px rgba(0, 0, 0, 0.2));
            transition: transform 0.3s ease;
        }

        /* Interactive hover effects */
        .illustration img:hover {
            transform: scale(1.02);
            filter: drop-shadow(0 8px 20px rgba(0, 0, 0, 0.3));
        }

        .text-content {
            width: 100%;
            height: auto;
            overflow-y: visible;
            min-height: 0;
            padding: 25px;
            background: transparent;
            font-size: 20px;
            line-height: 1.8;
            color: #2c1810;
            /* Darker brown for text */
            position: relative;
        }

        /* Drop Cap */
        .text-content p:first-of-type::first-letter {
            font-family: 'Chewy', cursive;
            font-size: 3.5em;
            float: left;
            line-height: 0.8;
            margin-right: 10px;
            color: #800000;
            text-shadow: 2px 2px 0px rgba(0, 0, 0, 0.1);
        }

        h1 {
            font-family: 'Chewy', cursive;
            color: #800000;
            margin-bottom: 15px;
            text-align: center;
            font-size: 42px;
            text-shadow: 1px 1px 0px rgba(255, 215, 0, 0.5);
            letter-spacing: 1px;
            margin-top: 0;
            border-bottom: 2px solid rgba(128, 0, 0, 0.2);
            padding-bottom: 10px;
        }

        /* Controls */
        .controls {
            position: fixed;
            bottom: 25px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 100;
            display: flex;
            justify-content: center;
            gap: 15px;
            padding: 12px 25px;
            background: rgba(62, 39, 35, 0.95);
            border-radius: 50px;
            border: 3px solid #d7ccc8;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.4);
            width: auto;
        }

        button {
            padding: 10px 25px;
            font-size: 20px;
            font-family: 'Chewy', cursive;
            background: #f4e4bc;
            color: #3e2723;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 0 #8d6e63;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 0 #8d6e63;
            background: #fff;
        }

        button:active {
            transform: translateY(2px);
            box-shadow: 0 0 0 #8d6e63;
        }

        button.icon-btn {
            padding: 10px 15px;
            font-size: 22px;
        }

        /* Map Modal */
        .map-modal,
        .victory-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.85);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            animation: fadeIn 0.3s;
        }

        /* Victory Modal Specifics */
        .victory-content {
            background: #fff;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            border: 10px solid #FFD700;
            max-width: 500px;
            font-family: 'Chewy';
            color: #3e2723;
            box-shadow: 0 0 50px rgba(255, 215, 0, 0.5);
            position: relative;
        }

        .victory-content h2 {
            font-size: 48px;
            color: #b71c1c;
            margin-bottom: 20px;
        }

        .victory-rabbit {
            width: 150px;
            margin-bottom: 20px;
            animation: bounce 2s infinite;
        }

        .map-content {
            width: 85%;
            max-width: 900px;
            height: 75vh;
            background: #a2d2df;
            border: 15px solid #5d4037;
            border-radius: 10px;
            position: relative;
            overflow: hidden;
            box-shadow: 0 0 50px rgba(0, 0, 0, 0.5);
            cursor: grab;
        }

        /* The styles for the map image */
        .map-content img.map-base {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        .close-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 100;
            background: #b71c1c;
            color: white;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            font-size: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            border: 3px solid white;
            font-family: 'Chewy', cursive;
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.3);
        }

        .map-marker {
            position: absolute;
            cursor: pointer;
            text-shadow: 0 0 10px rgba(255, 255, 255, 0.8);
            transform: translate(-50%, -50%);
            transition: transform 0.2s;
            z-index: 10;
        }

        .map-marker:hover {
            transform: translate(-50%, -50%) scale(1.2);
        }

        .marker-icon {
            font-size: 40px;
            filter: drop-shadow(0 2px 5px rgba(0, 0, 0, 0.3));
        }

        .marker-label {
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.9);
            padding: 5px 10px;
            border-radius: 5px;
            font-family: 'Chewy';
            color: #3e2723;
            white-space: nowrap;
            border: 1px solid #5d4037;
            pointer-events: none;
            font-size: 16px;
        }

        .pirate-ship-icon {
            position: absolute;
            font-size: 50px;
            animation: sailShip 8s linear infinite alternate;
            cursor: pointer;
            filter: drop-shadow(2px 4px 6px rgba(0, 0, 0, 0.3));
            user-select: none;
            z-index: 5;
        }

        /* Interactive Elements Overlay */
        .interactive-overlay {
            position: absolute;
            cursor: pointer;
            font-size: 40px;
            z-index: 15;
            transition: transform 0.2s;
            filter: drop-shadow(2px 4px 4px rgba(0, 0, 0, 0.2));
        }

        .interactive-overlay:hover {
            transform: scale(1.2);
        }

        .interactive-overlay:active {
            transform: scale(0.9);
        }

        .interactive-overlay.popped {
            animation: pop 0.4s ease-out;
        }

        @keyframes pop {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.4);
            }

            100% {
                transform: scale(1);
            }
        }

        @keyframes sailShip {
            0% {
                transform: translate(0, 0) rotate(5deg);
            }

            100% {
                transform: translate(30px, 10px) rotate(-5deg);
            }
        }

        /* Improved Rabbit Game UI */
        .hidden-rabbit {
            position: absolute;
            width: 60px;
            height: auto;
            opacity: 0.9;
            cursor: pointer;
            transition: all 0.3s;
            z-index: 20;
            /* Higher z-index to be clickable */
            filter: drop-shadow(0 0 0 rgba(255, 255, 255, 0));
        }

        .hidden-rabbit:hover {
            transform: scale(1.1) rotate(0deg) !important;
            /* Reset rotate to stand up */
            filter: drop-shadow(0 0 10px #FFD700);
            /* Glow to make it "clear" it's interactive */
            opacity: 1;
        }

        .hidden-rabbit.found {
            animation: rabbitJumpOut 1s forwards;
            pointer-events: none;
        }

        @keyframes rabbitJumpOut {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.5) translateY(-50px) rotate(360deg);
                opacity: 1;
            }

            100% {
                transform: scale(0) translateY(-100px);
                opacity: 0;
            }
        }

        .rabbit-counter-panel {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #f4e4bc;
            padding: 10px 20px;
            border-radius: 10px;
            border: 3px solid #5d4037;
            font-family: 'Chewy';
            color: #5d4037;
            z-index: 150;
            display: flex;
            align-items: center;
            gap: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            font-size: 24px;
            transform: rotate(2deg);
        }

        .rabbit-counter-panel img {
            width: 40px;
        }

        .game-tip {
            position: fixed;
            top: 90px;
            right: 20px;
            background: white;
            padding: 10px;
            border-radius: 10px;
            font-size: 14px;
            max-width: 200px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            z-index: 140;
            display: none;
            /* Shown by JS initially */
            animation: pulse 2s infinite;
        }

        .page-number {
            position: absolute;
            bottom: 25px;
            right: 35px;
            font-family: 'Chewy';
            font-size: 20px;
            color: #5d4037;
            border: 2px solid #5d4037;
            border-radius: 50%;
            width: 45px;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 255, 255, 0.5);
            box-shadow: 2px 2px 5px rgba(0, 0, 0, 0.1);
        }

        .teaser-text {
            border-top: 2px dashed #8d6e63;
            margin-top: 30px;
            padding-top: 20px;
            text-align: center;
            font-size: 18px;
            color: #5d4037;
            font-style: italic;
        }

        /* Animations */
        .anim-float {
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {

            0%,
            100% {
                transform: translateY(0px);
            }

            50% {
                transform: translateY(-10px);
            }
        }

        .anim-sail {
            animation: sail 4s ease-in-out infinite;
        }

        @keyframes sail {

            0%,
            100% {
                transform: rotate(-2deg);
            }

            50% {
                transform: rotate(2deg);
            }
        }

        .anim-glow {
            animation: glow 3s ease-in-out infinite;
        }

        @keyframes glow {

            0%,
            100% {
                filter: drop-shadow(0 0 5px gold);
            }

            50% {
                filter: drop-shadow(0 0 15px gold);
            }
        }

        @keyframes bounce {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-20px);
            }
        }

        .anim-battle {
            animation: shake 0.5s cubic-bezier(.36, .07, .19, .97) infinite;
        }

        @keyframes shake {

            10%,
            90% {
                transform: translate3d(-1px, 0, 0);
            }

            20%,
            80% {
                transform: translate3d(2px, 0, 0);
            }
        }

        /* Responsive */
        @media screen and (min-width: 1025px) {
            .page {
                flex-direction: row;
                gap: 50px;
                padding: 60px;
            }

            .cover-page {
                flex-direction: column !important;
            }

            .illustration {
                width: 50%;
                height: 100%;
                border: none;
                box-shadow: none;
                background: transparent;
            }

            .text-content {
                width: 50%;
                height: 100%;
                overflow-y: auto;
                padding-right: 20px;
                font-size: 24px;
            }

            .controls {
                bottom: 30px;
            }

            .illustration-group {
                flex-direction: column;
                gap: 20px;
            }

            .page8-knight {
                width: 50%;
                display: block !important;
            }

            .page8-house {
                width: 70%;
            }
        }

        @media screen and (max-width: 768px) {
            .book-container {
                border-left: 15px solid #3e2723;
                width: 100vw;
                height: 100vh;
                border-radius: 0;
            }

            .page {
                padding: 20px 20px 100px 20px;
            }

            h1 {
                font-size: 28px;
            }

            .cover-title {
                font-size: 40px;
            }

            .cover-collage {
                height: 300px;
            }

            .cover-main-img {
                height: 200px;
            }

            .controls {
                width: 95%;
                bottom: 10px;
            }

            .text-content p:first-of-type::first-letter {
                font-size: 2.5em;
            }

            .page8-knight {
                display: none;
            }

            .rabbit-counter-panel {
                padding: 5px 10px;
                font-size: 18px;
                top: 10px;
                right: 10px;
            }

            .rabbit-counter-panel img {
                width: 30px;
            }
        }

        .illustration-group {
            position: relative;
            height: 100%;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: row;
        }
    </style>
</head>

<body>
    <audio id="snd-turn" src="https://assets.mixkit.co/active_storage/sfx/2045/2045-preview.mp3"></audio>
    <audio id="snd-yay" src="https://assets.mixkit.co/active_storage/sfx/1114/1114-preview.mp3"></audio>
    <audio id="snd-ocean" src="https://assets.mixkit.co/active_storage/sfx/1188/1188-preview.mp3" loop></audio>
    <audio id="snd-sword" src="https://assets.mixkit.co/active_storage/sfx/1271/1271-preview.mp3"></audio>
    <audio id="snd-cannon" src="https://assets.mixkit.co/active_storage/sfx/1703/1703-preview.mp3"></audio>
    <audio id="snd-bells" src="https://assets.mixkit.co/active_storage/sfx/573/573-preview.mp3"></audio>
    <audio id="snd-pop" src="https://assets.mixkit.co/active_storage/sfx/2578/2578-preview.mp3"></audio>

    <div class="rabbit-counter-panel">
        <img src="rabbit.png" alt="Rabbit"> <span id="rabbit-count">0/8 Found</span>
    </div>

    <div class="game-tip" id="gameTip">
        <strong>Psst!</strong> Help Wally find the hidden rabbits on each page! üê∞
    </div>

    <div class="book-container">

        <!-- Cover Page -->
        <div class="page cover-page active">
            <h1 class="cover-title">Wally Worner<br>and the<br>Siege of Senglea</h1>

            <div class="cover-collage">
                <img src="castle.png" class="cover-bg-img"
                    style="left: 10%; top: 20%; transform: rotate(-10deg); width: 150px;">
                <img src="ship.png" class="cover-bg-img"
                    style="right: 10%; top: 30%; transform: rotate(10deg); width: 150px;">
                <img src="rabbit.png" class="cover-bg-img" style="bottom: 10%; right: 20%; width: 80px; opacity: 1;">

                <img src="worner.png" alt="Wally Worner" class="cover-main-img">
            </div>

            <p class="cover-decoration">A Tale of Courage, Honor, and Rabbits</p>

            <button class="start-btn" onclick="nextPage()">Start Reading</button>
        </div>

        <!-- Page 1: Title (NOW PAGE 1 of story) -->
        <div class="page">
            <img src="rabbit.png" class="hidden-rabbit" style="bottom: 85px; left: 30px; transform: rotate(10deg);"
                onclick="foundRabbit(this)">
            <div class="illustration" onclick="animateElement(this, 'wiggle')">
                <img src="worner.png" alt="Wally Worner" class="anim-float click-wiggle">
                <div
                    style="position: absolute; bottom: 10px; background: #FFD700; padding: 5px 20px; border-radius: 20px; font-family: 'Chewy'; font-size: 24px; color: #5d4037; border: 3px solid #5d4037; z-index: 50; box-shadow: 0 4px 5px rgba(0,0,0,0.3);">
                    Wally Worner</div>
            </div>
            <div class="text-content">
                <h1>Wally Worner and the Siege of Senglea</h1>
                <p><strong>A Tale of Courage and Honor</strong></p>
                <p style="margin-top: 20px;">Long ago in 1565, there lived a brave knight named Wally Worner. His name
                    meant "guardian warrior," and he carried a bright yellow shield with a bold red stripe and six red
                    flowers.</p>
                <p style="margin-top: 15px;">His family motto was: <em>"Non nobis tantum nati"</em> ‚Äî "Not born for
                    ourselves alone."</p>
                <p style="margin-top: 15px;">This is the story of how Wally helped save Malta and defended a
                    special house that would shine like a star through the centuries...</p>
            </div>
            <div class="page-number">1</div>
        </div>

        <!-- Page 2: The Call -->
        <div class="page">
            <img src="rabbit.png" class="hidden-rabbit" style="top: 20px; right: 30px; transform: rotate(-5deg);"
                onclick="foundRabbit(this)">
            <div class="interactive-overlay" style="bottom: 50px; left: 40px;" onclick="interactFood(this)"
                title="Maltese Bread">üçû</div>
            <div class="interactive-overlay" style="bottom: 60px; left: 80px;" onclick="interactFood(this)"
                title="Cheese">üßÄ</div>

            <div class="illustration" onclick="animateElement(this, 'wiggle')">
                <img src="castle.png" alt="Castle" class="anim-float click-wiggle">
            </div>
            <div class="text-content">
                <h1>The Call to Malta</h1>
                <p>One spring morning, a messenger arrived at Wally Worner's castle with urgent news. The beautiful
                    island
                    of Malta was in terrible danger!</p>
                <p style="margin-top: 15px;">The Ottoman Empire had sent hundreds of ships carrying thousands of
                    soldiers to capture the island. Malta was defended by the Knights of St. John, led by the great
                    Grand Master Jean de la Valette, but they were outnumbered ten to one.</p>
                <p style="margin-top: 15px;">Wally looked at his coat of arms. He thought about his motto. Then he
                    made his decision.</p>
                <p style="margin-top: 15px;"><em>"I must go," Wally told his squire Thomas. "Others need protection, and
                        that is what a Worner does. Quickly, pack the ftira bread and cheese, it will be a long
                        journey!"</em></p>
            </div>
            <div class="page-number">2</div>
        </div>

        <!-- Page 3: The Voyage -->
        <div class="page">
            <img src="rabbit.png" class="hidden-rabbit"
                style="top: 130px; left: 40px; transform: rotate(5deg); opacity: 0.8;" onclick="foundRabbit(this)">
            <div class="illustration" onclick="animateElement(this, 'sail')">
                <img src="ship.png" alt="Ship" class="anim-sail click-wiggle">
            </div>
            <div class="text-content">
                <h1>The Journey Across the Sea</h1>
                <p>The voyage across the Mediterranean Sea was Wally Worner's first great adventure. His ship battled
                    terrible storms.</p>
                <p style="margin-top: 15px;">The Mediterranean was dangerous‚ÄîOttoman warships AND Barbary pirates
                    prowled these waters. Wally kept watch through the night, spotting mysterious sails on the horizon.
                </p>
                <p style="margin-top: 15px;">One night, Wally noticed something strange‚Äîthe
                    stars were arranged in a pattern he'd never seen before.</p>
                <p style="margin-top: 15px;"><em>"Sometimes, a guardian must trust his heart as much as his sword,"</em>
                    Wally replied with a smile.</p>
            </div>
            <div class="page-number">3</div>
        </div>

        <!-- Page 4: Meeting Valette -->
        <div class="page">
            <img src="rabbit.png" class="hidden-rabbit" style="bottom: 120px; right: 30px;" onclick="foundRabbit(this)">
            <div class="interactive-overlay" style="bottom: 60px; right: 100px; font-size: 30px;"
                onclick="interactFood(this)" title="Sausage">üå≠</div>
            <div class="illustration" onclick="animateElement(this, 'wiggle')">
                <img src="fortress.png" alt="Fortress" class="click-wiggle">
            </div>
            <div class="text-content">
                <h1>Meeting Jean de la Valette</h1>
                <p>When Wally arrived at Malta, the island was already under siege. He was brought before Jean de
                    la Valette himself.</p>
                <p style="margin-top: 15px;"><em>"Sir Wallace Worner, your motto‚Äî'Not born for ourselves alone.' We
                        shall need
                        men who believe such words. If Senglea falls, Malta falls."</em></p>
                <p style="margin-top: 15px;"><em>"Then Senglea must not fall,"</em> Sir Wallace Worner said firmly.</p>
                <p style="margin-top: 15px;">Jean de la Valette smiled. They shared a meal of spicy Maltese sausage and
                    olives. Sir Wallace ate heartily, knowing strength would be needed for what was to come.</p>
            </div>
            <div class="page-number">4</div>
        </div>

        <!-- Page 5: Senglea -->
        <div class="page">
            <img src="rabbit.png" class="hidden-rabbit" style="top: 20px; left: 20px; transform: rotate(15deg);"
                onclick="foundRabbit(this)">
            <div class="interactive-overlay" style="top: 80px; left: 40px;" onclick="interactFood(this)"
                title="Honey Ring">ü•Ø</div>
            <div class="illustration" onclick="animateElement(this, 'glow')">
                <img src="house_stella.png" alt="Stella House" class="anim-glow click-glow">
            </div>
            <div class="text-content">
                <h1>The House Called Stella</h1>
                <p>That night, Wally Worner explored the streets of Senglea. He walked down Triq il-Kurcifiss‚Äîthe Street
                    of the Crucifix. One house caught his eye: number 38.</p>
                <p style="margin-top: 15px;">An old Maltese woman smiled at Wally and offered him fresh ftira bread and
                    gbejniet cheese. "This is what we eat here in Senglea," she said. "Protect us, Sir Knight, and I'll
                    make you my famous stuffat tal-fenek‚Äîrabbit stew!"</p>
                <p style="margin-top: 15px;">A little rabbit hopped past in the street, and everyone laughed. <em>"I
                        will,"</em> Wally promised. <em>"This place will stand."</em>
                </p>
            </div>
            <div class="page-number">5</div>
        </div>

        <!-- Page 6: The Battle -->
        <div class="page">
            <img src="rabbit.png" class="hidden-rabbit" style="bottom: 20px; left: 50%; transform: translateX(-50%);"
                onclick="foundRabbit(this)">
            <!-- Interactive Cannons -->
            <div class="interactive-overlay" style="bottom: 60px; left: 40px; font-size: 50px;"
                onclick="fireCannon(this)" title="Fire Cannon!">üí£</div>
            <div class="interactive-overlay" style="bottom: 80px; right: 40px; font-size: 40px;"
                onclick="fireCannon(this)" title="Fire Cannon!">üí•</div>

            <div class="illustration" onclick="animateElement(this, 'shake')">
                <img src="battle.png" alt="Battle" class="anim-battle click-wiggle">
            </div>
            <div class="text-content">
                <h1>The Great Battle for Senglea</h1>
                <p>On August 7th, 1565, the Ottomans launched their greatest assault.</p>
                <p style="margin-top: 15px;">Jean de la Valette turned to Wally Worner: <em>"Take command of the harbor
                        defenses. I trust you."</em></p>
                <p style="margin-top: 15px;">Wally had a brilliant idea. He positioned cannons in the houses along
                    Triq il-Kurcifiss, especially number 38. From its windows, they could see the entire harbor
                    approach! Between attacks, defenders shared honey rings to keep their energy high.</p>
                <p style="margin-top: 15px;">All day the battle raged. By sunset, the Ottoman forces retreated. Senglea
                    still stood!</p>
            </div>
            <div class="page-number">6</div>
        </div>

        <!-- Page 7: The Gift -->
        <div class="page">
            <img src="rabbit.png" class="hidden-rabbit" style="top: 30px; left: 50px;" onclick="foundRabbit(this)">
            <div class="interactive-overlay" style="top: 120px; left: 60px; font-size: 45px;"
                onclick="interactFood(this)" title="Rabbit Stew">ü•ò</div>
            <div class="illustration" onclick="animateElement(this, 'glow')">
                <img src="house_stella.png" alt="Stella House" class="anim-glow click-glow">
            </div>
            <div class="text-content">
                <h1>Stella - The Star</h1>
                <p>That evening, people celebrated. The old woman brought Wally a steaming bowl of stuffat tal-fenek.
                    "The best rabbit stew in all Malta!" she declared.</p>
                <p style="margin-top: 15px;">Jean de la Valette raised his cup: <em>"To Wally Worner, the Guardian of
                        Stella!"</em></p>
                <p style="margin-top: 15px;">Then Valette looked at Sir Wallace seriously. <em>"I want you to have
                        Stella‚Äînumber 38 Triq il-Kurcifiss. It is yours,
                        for you and your family, for all generations to come."</em></p>
                <p style="margin-top: 15px;">Sir Wallace Worner accepted with tears in his eyes. <em>"The Star. I will
                        ensure it
                        shines for generations."</em></p>
            </div>
            <div class="page-number">7</div>
        </div>

        <!-- Page 8: The Legacy -->
        <div class="page">
            <img src="rabbit.png" class="hidden-rabbit" style="bottom: 20px; right: 20px;" onclick="foundRabbit(this)">
            <div class="illustration">
                <div class="illustration-group">
                    <img src="worner.png" alt="Wally Worner" class="anim-float page8-knight click-wiggle"
                        onclick="animateElement(this, 'wiggle')">
                    <img src="house_stella.png" alt="Stella House" class="page8-house click-glow"
                        onclick="animateElement(this, 'glow')">
                </div>
            </div>
            <div class="text-content">
                <h1>The Legacy Lives On</h1>
                <p>The siege continued, but Malta was saved!</p>
                <p style="margin-top: 15px;">Wally Worner made Stella his home. He restored its battle-damaged walls,
                    planted flowers, and built a rabbit hutch in the courtyard.</p>
                <p style="margin-top: 15px;">Years passed, then decades, then centuries. Stella remained, passed down
                    through generations. Each generation added their stories, but never forgot the brave knight who
                    defended it.</p>
                <p style="margin-top: 15px;">And today, Stella still stands‚Äîa reminder of Sir Wallace Worner's courage.
                </p>

                <div class="teaser-text">
                    <p><strong>COMING SOON...</strong></p>
                    <p>BOOK TWO: "Wally Worner's Grandson and the Siege of Malta 1940-1943"</p>
                </div>
            </div>
            <div class="page-number">8</div>
        </div>

        <div class="controls">
            <button class="icon-btn" onclick="toggleMap()" title="View Map">üó∫Ô∏è</button>
            <button id="prevBtn" onclick="previousPage()">‚Üê Back</button>
            <button id="nextBtn" onclick="nextPage()">Next ‚Üí</button>
            <button class="icon-btn" onclick="toggleSound()" id="soundBtn" title="Toggle Sound">üîä</button>
        </div>
    </div>

    <!-- Map Modal -->
    <div class="map-modal" id="mapModal">
        <div class="map-content" id="mapContent">
            <div class="close-btn" onclick="toggleMap()">√ó</div>
            <img src="map_malta.png" class="map-base" alt="Map of Malta 1565">

            <!-- Markers based on the image being centered -->
            <div class="map-marker" style="top: 50%; left: 50%;" onclick="zoomMap('senglea')">
                <div class="marker-icon">‚≠ê</div>
                <span class="marker-label">Senglea</span>
            </div>

            <div class="pirate-ship-icon" style="top: 20%; left: 20%;">üè¥‚Äç‚ò†Ô∏è</div>
            <div class="pirate-ship-icon" style="bottom: 25%; right: 25%; animation-delay: 1s;">‚õµ</div>
            <div class="pirate-ship-icon" style="top: 40%; right: 15%; animation-delay: 2s;">üè¥‚Äç‚ò†Ô∏è</div>

            <div
                style="position: absolute; bottom: 20px; left: 20px; color: white; font-family: 'Patrick Hand'; font-size: 20px; background: rgba(0,0,0,0.5); padding: 10px; border-radius: 5px;">
                Explore the Grand Harbour of 1565!
            </div>
        </div>
    </div>

    <!-- Victory Modal -->
    <div class="victory-modal" id="victoryModal">
        <div class="victory-content" id="victoryContent">
            <div class="close-btn" style="top: -20px; right: -20px;" onclick="closeVictory()">√ó</div>
            <h2>Rabbit Hero!</h2>
            <img src="rabbit.png" class="victory-rabbit" alt="Happy Rabbit">
            <p style="font-size: 24px;">You found all 8 hidden rabbits!</p>
            <p>The Knights of Malta salute your keen eyes!</p>
        </div>
    </div>

    <script>
        let currentPage = 0;
        const pages = document.querySelectorAll('.page');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const victoryModal = document.getElementById('victoryModal');
        let soundEnabled = true;
        let rabbitCount = 0;

        // Sound Effects
        function toggleSound() {
            soundEnabled = !soundEnabled;
            const btn = document.getElementById('soundBtn');
            btn.textContent = soundEnabled ? 'üîä' : 'üîá';

            // Stop loop sounds if muted
            if (!soundEnabled) {
                document.getElementById('snd-ocean').pause();
            }
        }

        function playSound(type) {
            if (!soundEnabled) return;

            const soundMap = {
                'turn': 'snd-turn',
                'yay': 'snd-yay',
                'ocean': 'snd-ocean',
                'sword': 'snd-sword',
                'cannon': 'snd-cannon',
                'bells': 'snd-bells',
                'pop': 'snd-pop'
            };

            const audioId = soundMap[type];
            if (audioId) {
                const audio = document.getElementById(audioId);
                if (audio) {
                    if (audioId !== 'snd-ocean') audio.currentTime = 0;
                    audio.play().catch(e => console.log("Audio prevent default"));
                }
            }
        }

        function stopSound(type) {
            const soundMap = { 'ocean': 'snd-ocean' };
            const audioId = soundMap[type];
            if (audioId) {
                const audio = document.getElementById(audioId);
                audio.pause();
                audio.currentTime = 0;
            }
        }

        function showPage(index) {
            playSound('turn');

            // Page specific sounds
            stopSound('ocean');

            // Note: Index is shifted by 1 now because of cover page
            // Page 3 (Voyage) is now index 3 (0=Cover, 1=Page1, 2=Page2, 3=Page3)
            if (index === 3) {
                const ocean = document.getElementById('snd-ocean');
                if (soundEnabled) ocean.play().catch(e => console.log(e));
            }
            // Page 7 (Victory) is now index 7
            if (index === 7) {
                playSound('bells');
            }


            pages.forEach((page, i) => {
                page.classList.remove('active');
                if (i === index) {
                    page.classList.add('active');
                }
            });

            if (prevBtn && nextBtn) {
                prevBtn.style.visibility = index === 0 ? 'hidden' : 'visible';
                nextBtn.style.visibility = index === pages.length - 1 ? 'hidden' : 'visible';
            }
        }

        function nextPage() {
            if (currentPage < pages.length - 1) {
                currentPage++;
                showPage(currentPage);
            }
        }

        function previousPage() {
            if (currentPage > 0) {
                currentPage--;
                showPage(currentPage);
            }
        }

        // Map
        function toggleMap() {
            const modal = document.getElementById('mapModal');
            modal.style.display = modal.style.display === 'flex' ? 'none' : 'flex';
        }

        function zoomMap(location) {
            if (location === 'senglea') {
                alert("This is Senglea! The home of Stella and the heart of the defense!");
            }
        }

        function closeVictory() {
            victoryModal.style.display = 'none';
        }

        // Animations
        function animateElement(element, type) {
            // Remove class to reset
            element.classList.remove(type);

            // Add 'clicked' class to trigger one-off animation
            element.classList.add('clicked');
            setTimeout(() => {
                element.classList.remove('clicked');
            }, 1000);

            // Battle page click on main image triggers sword sound
            if (type === 'shake') {
                playSound('sword');
            }
        }

        // Interactive Items (Cannons, Food)
        function fireCannon(element) {
            playSound('cannon');
            element.classList.add('popped');
            setTimeout(() => { element.classList.remove('popped'); }, 500);

            // Shake the page a bit!
            const page = element.closest('.page');
            page.style.transform = 'translate(5px, 0)';
            setTimeout(() => { page.style.transform = 'translate(-5px, 0)'; }, 50);
            setTimeout(() => { page.style.transform = 'none'; }, 100);
        }

        function interactFood(element) {
            playSound('pop');
            element.classList.add('popped');
            setTimeout(() => { element.classList.remove('popped'); }, 500);
        }

        // Rabbit Game
        function foundRabbit(element) {
            if (element.classList.contains('found')) return;

            element.classList.add('found');
            rabbitCount++;
            document.getElementById('rabbit-count').textContent = rabbitCount + "/8 Found";
            playSound('yay');

            if (rabbitCount === 8) {
                setTimeout(() => {
                    victoryModal.style.display = 'flex';
                    playSound('yay');
                }, 1000);
            }
        }

        // Game Tips
        setTimeout(() => {
            const tip = document.getElementById('gameTip');
            tip.style.display = 'block';
            setTimeout(() => { tip.style.display = 'none'; }, 5000);
        }, 2000);

        // Keyboard navigation
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowRight') nextPage();
            if (e.key === 'ArrowLeft') previousPage();
        });

        // Initialize
        showPage(0);
    </script>
</body>

</html>